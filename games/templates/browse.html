{% extends "layout.html" %}

{% block content %}

<h2>Browse Games</h2>

<!-- This stuff hasn't been styled properly, feel free to move stuff around if you like. -->

<!-- This stuff is used to change the search settings -->
<div class="search-section">
    <h3>Search for a game:</h3>
    {% include "search.html" %}
</div>

<div class="sort-by-section">
    <h3>Sort games by:</h3>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath='title/'+cur_tag_path, search=cur_search, genre=cur_genre) }}"><div>Title</div></a>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath='popular/'+cur_tag_path, search=cur_search, genre=cur_genre) }}"><div>Popular</div></a>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath='price/'+cur_tag_path, search=cur_search, genre=cur_genre) }}"><div>Price</div></a>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath='recent/'+cur_tag_path, search=cur_search, genre=cur_genre) }}"><div>Recent</div></a>
</div>

<div class="tag-filter-section">
    <h3>Filter by tags:</h3>
    <form class="tag-filter" action="{{ url_for('games_bp.browse_games_read_form', subpath=cur_subpath, search=cur_search, genre=cur_genre) }}" method="POST">
        <label>Select from these random tags:</label>
        {% for tag in random_tags %}
        <label><input type="checkbox" name="tag-{{tag}}" value="{{ tag }}"><span>{{ tag }}</span></label>
        {% endfor %}<br>

        <label>Select from all tags:</label>
        <select name="tag-dropdown" id="tag-dropdown">
            <option value="null-selection">Select a tag</option>
            {% for tag in  all_tags %}
                <option value="{{ tag }}">{{ tag }}</option>
            {% endfor %}
        </select>

        <input type="submit" value="Add tags" class="button">
    </form>
</div>

<div class="genre-filter-section">
    <h3>Filter by genre:</h3>
    <label>Select a random genre:</label>
    {% for genre in random_genres %}
        <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, genre=genre) }}">{{ genre }}</a>
    {% endfor %}<br>

    <form class="genre-filter" action="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, search=cur_search) }}" method="GET">
        <label>Select from all genres:</label>
        <select name="genre" id="genre-dropdown">
            <option value="null-selection">Select a genre</option>
            {% for genre in  all_genres %}
                <option value="{{ genre }}">{{ genre }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Search" class="button">
    </form>
</div>

<!-- Current search settings -->
{% if cur_search %}
    <b>Search by: </b>
    <div class="info-puck">{{ cur_search }}</div>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, genre=cur_genre) }}"><div class="button">Clear search</div></a><br>
{% endif %}

{% if cur_sort %}
    <b>Sort Query: </b>
    <div class="info-puck">{{ cur_sort }}</div>
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_tag_path, search=cur_search, genre=cur_genre) }}"><div class="button">Clear sort</div></a><br>
{% endif %}

{% if cur_tags %}
    <b>Tags: </b>
    {% for tag in cur_tags %}
        <div class="info-puck">{{ tag }}</div>
    {% endfor %}
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_sort, search=cur_search, genre=cur_genre) }}"><div class="button">Clear selected tags</div></a><br>
{% endif %}

{% if cur_genre %}
    <b>Genre: </b>{{cur_genre}}
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, search=cur_search) }}"><div class="button">Browse all</div></a>
{% endif %}

<!-- Results of search -->
<h2>Showing {{games|length}} out of {{num_games}}</h2>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>TITLE</th>
            <th>RELEASE DATE</th>
        </tr>
    </thead>
    <tbody>
        {% for game in games %}
        <tr>
            <td>{{ game.game_id }}</td>
            <td><a href="{{ url_for('game_bp.game_view', game_id=game.game_id) }}">{{ game.title }}</a></td>
            <td>{{ game.game_url }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if page > 1 %}
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, search=cur_search, genre=cur_genre, page=page-1) }}"><div class="button">Previous Page</div></a>
{% else %}
    <div class="inactive-button">Previous Page</div>
{% endif %}
<b>Page: {{ page }} of: {{ max_page }}</b>
{% if page < max_page %}
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=cur_subpath, search=cur_search, genre=cur_genre, page=page+1) }}"><div class="button">Next Page</div></a>
{% else %}
    <div class="inactive-button">Next Page</div>
{% endif %}

{% endblock %}
