{% extends "layout.html" %}

{% block head %}
    {{ super() }}
    <title>{{ game.title }} | CS235 Game Library</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css')}}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chip.css')}}"/>
{% endblock %}


{% block heading %}
    <!-- <img src="{{ game.image_url }}" alt="Header image of game" class="game-image"> -->
{% endblock %}


{% block content %}

<!-- Move me somewhere appropriate -->
<a href="{{ url_for('game_bp.add_to_wishlist', game_id = game_id) }}">Add to wishlist</a>

<div id="game-header">
    <img src="{{ game.image_url }}" alt="Header image of game" class="game-image">
    <div id="game-info">
        <h1>{{ game.title }}</h1>

        <!-- info chips -->
        <div class="chip price-chip"><i class="fas fa-dollar-sign"></i>{{ game.price }} USD</div>
        <div class="chip recommendation-chip"><i class="fas fa-thumbs-up"></i>{{ game.recommendations }} Recommend This</div>
        <a href="{{ url_for('game_bp.add_to_wishlist', game_id = game_id) }}"><div class="chip button">Add to wishlist</div></a>

        <!-- <br/> -->

        <!-- <p>
            Lorem ipsum dolor sit amet consectetur, adipisicing elit. Itaque sit illum, dolore porro nemo doloremque repellat iste dignissimos, natus repudiandae dolores est repellendus nobis? Error quam deleniti aperiam voluptatum quod...
        </p> -->

        <!-- <i class="fas fa-calendar"></i><strong>Release Date:</strong> {{ game.release_date }} -->
    </div>

</div>


<!-- description -->
<h2><i class="fas fa-info-circle header-icon"></i>About</h2>
<div id="game-about"><i>{{ game.description }}</i></div>

<!-- details -->
<ul id="game-details">
    <li><i class="fas fa-calendar"></i><strong>Release Date:</strong> {{ game.release_date }}</li>
    <li><i class="fas fa-gamepad"></i><strong>Genres:</strong> 
        {% for genre in game.genres %}
            {{ genre.genre_name }}{% if not loop.last %}, {% endif %}
        {% endfor %}
    </li>
    <li><i class="fas fa-trophy"></i><strong>Achievements:</strong> {{ game.achievements }}</li>
    <li><i class="fas fa-desktop"></i><strong>Platforms:</strong> {{ platform_support }}</li>
    <li><i class="fas fa-gamepad"></i><strong>Controller:</strong> {{ controller_support }}</li>
    <li><i class="fas fa-cloud"></i><strong>Steam Cloud:</strong> {{ cloud_support }}</li>
    <li><i class="fas fa-user"></i><strong>Developers:</strong> {{ game.developer }}</li>
    <li><i class="fas fa-user"></i><strong>Publishers:</strong> {{ game.publisher.publisher_name }}</li>
</ul>

<!-- reviews -->
<h2><i class="fas fa-star header-icon"></i>Reviews</h2>
{% set avg_rating = game.reviews|sum(attribute='rating') / game.reviews|length %}
<div id="avg-ratings">
    <div id="average-rating-container">
        <h2>{{ avg_rating|round(1) }}</h2>
        <span class="stars">{{ star_rating(avg_rating) }}</span>
        <span>{{ game.reviews|length }} reviews</span>
    </div>
</div>
<ul id="game-reviews">
    {% for review in game.reviews|sort(attribute="date", reverse=true) %}
        <li class="review">
            <div class="review-header">
                <span>{{ review.user.username }}</span>
                <span class="stars">{{ star_rating(review.rating) }}</span>
                <span>{{ review.date.strftime('%B %d, %Y')}}</span>
            </div>
            <div class="review-body">{{ review.comment }}</div>
        </li>
    {% endfor %}
</ul>

<!-- categories -->
<h2><i class="fas fa-shapes header-icon"></i>Categories</h2>
{% for cat in game.categories %}
{{ cat }}{% if not loop.last %}, {% endif %}
{% endfor %}

<!-- tags -->
<h2><i class="fas fa-tags header-icon"></i>Tags</h2>
{% for tag in game.tags %}
    <a href="{{ url_for('games_bp.browse_games_with_options', subpath=tag) }}"><div class="button">{{ tag }}</div></a>
{% endfor %}

<div style="height: 200px"></div>

{% endblock %}
